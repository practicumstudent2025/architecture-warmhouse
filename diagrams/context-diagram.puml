@startuml
!include <C4/C4_Context>

title Контекстная диаграмма: Текущая система "Тёплый дом"

Person(Пользователь, "Пользователь (владелец дома)", "Управляет отоплением\nПроверяет температуру")
Person(Специалист, "Специалист по установке", "Регистрирует устройства\nНастраивает систему при выезде")

System(Веб_приложение, "Веб-приложение", "Монолит на Go\nУправление отоплением\nСинхронное взаимодействие")
SystemDb(PostgreSQL, "База данных", "PostgreSQL\nХранение состояния\nКонфигурации устройств")
System_Boundary(boundary, "Экосистема 'Тёплый дом'") {
    System(Устройства, "Умные устройства", "100 модулей управления отоплением\nДатчики температуры\nРеле управления")
}

' Связи между компонентами
Rel(Пользователь, Веб_приложение, "Управляет отоплением\nЗапрашивает температуру", "HTTPS")
Rel(Специалист, Веб_приложение, "Регистрирует устройства\nКонфигурирует систему", "HTTPS")
Rel(Веб_приложение, Устройства, "Отправка команд\nЗапрос данных", "Синхронные API вызовы\n(HTTP/MQTT)")
Rel(Веб_приложение, PostgreSQL, "Чтение/запись данных", "SQL")
Rel_Back(Устройства, Веб_приложение, "Отправка телеметрии", "Синхронные ответы")

' Аннотации проблемных мест
annotationOver(Веб_приложение, PostgreSQL, "Единая точка отказа", $sprite="red")
annotationOver(Веб_приложение, Устройства, "Блокирующие вызовы", $sprite="red")
annotationOver(Устройства, "Нет автономности\nТребуется ручная установка", $sprite="yellow")

legend right
  | Цвет | Значение |
  | <$sprite{red}> | Критические проблемы |
  | <$sprite{yellow}> | Ограничения |
endlegend

@enduml 